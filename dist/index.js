var E=Object.create;var w=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of F(t))!J.call(e,s)&&s!==i&&w(e,s,{get:()=>t[s],enumerable:!(n=C(t,s))||n.enumerable});return e};var B=(e,t,i)=>(i=e!=null?E(N(e)):{},_(t||!e||!e.__esModule?w(i,"default",{value:e,enumerable:!0}):i,e));var A=L((X,P)=>{P.exports=y;y.flatten=y;y.unflatten=O;function x(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function j(e){return e}function y(e,t){t=t||{};let i=t.delimiter||".",n=t.maxDepth,s=t.transformKey||j,o={};function u(c,l,g){g=g||1,Object.keys(c).forEach(function(a){let r=c[a],f=t.safe&&Array.isArray(r),p=Object.prototype.toString.call(r),d=x(r),b=p==="[object Object]"||p==="[object Array]",m=l?l+i+s(a):s(a);if(!f&&!d&&b&&Object.keys(r).length&&(!t.maxDepth||g<n))return u(r,m,g+1);o[m]=r})}return u(e),o}function O(e,t){t=t||{};let i=t.delimiter||".",n=t.overwrite||!1,s=t.transformKey||j,o={};if(x(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function c(a){let r=Number(a);return isNaN(r)||a.indexOf(".")!==-1||t.object?a:r}function l(a,r,f){return Object.keys(f).reduce(function(p,d){return p[a+i+d]=f[d],p},r)}function g(a){let r=Object.prototype.toString.call(a),f=r==="[object Array]",p=r==="[object Object]";if(a){if(f)return!a.length;if(p)return!Object.keys(a).length}else return!0}return e=Object.keys(e).reduce(function(a,r){let f=Object.prototype.toString.call(e[r]);return!(f==="[object Object]"||f==="[object Array]")||g(e[r])?(a[r]=e[r],a):l(r,a,y(e[r],t))},{}),Object.keys(e).forEach(function(a){let r=a.split(i).map(s),f=c(r.shift()),p=c(r[0]),d=o;for(;p!==void 0;){if(f==="__proto__")return;let b=Object.prototype.toString.call(d[f]),m=b==="[object Object]"||b==="[object Array]";if(!n&&!m&&typeof d[f]<"u")return;(n&&!m||!n&&d[f]==null)&&(d[f]=typeof p=="number"&&!t.object?[]:{}),d=d[f],r.length>0&&(f=c(r.shift()),p=c(r[0]))}d[f]=O(e[a],t)}),o}});function $(e){return t=>i=>e({settings:t,env:i})}var h=B(A(),1);function I(e){if(e.pathPattern===void 0)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.includes("{language}")===!1)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.endsWith(".json")===!1)throw new Error("The pathPattern setting must end with '.json'. An example would be './resources/{language}.json'.")}var K=$(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return I(e),{languages:await M({$fs:t.$fs,settings:e}),readResources:async i=>W({...i,$fs:t.$fs,settings:e}),writeResources:async i=>v({...i,$fs:t.$fs,settings:e})}}}));async function M(e){let[t,i]=e.settings.pathPattern.split("{language}"),n=await e.$fs.readdir(t),s=[];for(let o of n)if(o.includes("."))o.endsWith(".json")&&s.push(o.replace(".json",""));else for(let u of await e.$fs.readdir(`${t}${o}`))u.endsWith(".json")&&!s.some(c=>c===o)&&s.push(o);return s}async function W(e){let t=[];for(let i of e.config.languages){let n=e.settings.pathPattern.replace("{language}",i);try{let s=await e.$fs.readFile(n,{encoding:"utf-8"}),o=JSON.parse(s),u=R(await e.$fs.readFile(n,{encoding:"utf-8"})),c=(0,h.default)(o);t.push(S(c,i,!1,u,e.settings.variableReferencePattern))}catch{let s={},o=`${n.replace("/*.json","")}`,u=await e.$fs.readdir(o),c=R(await e.$fs.readFile(`${o}/${u[0]}`,{encoding:"utf-8"}));for(let l of u){let g={},a=await e.$fs.readFile(`${o}/${l}`,{encoding:"utf-8"});g[l.replace(".json","")]=JSON.parse(a);let r=(0,h.default)(g);s={...s,...r}}t.push(S(s,i,!0,c,e.settings.variableReferencePattern))}}return t}function S(e,t,i,n,s){return{type:"Resource",metadata:{space:n},languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([o,u])=>D(o,u,i,s))}}function D(e,t,i,n){let s=n&&(n[1]?new RegExp(`(\\${n[0]}[^\\${n[1]}]+\\${n[1]})`,"g"):new RegExp(`(${n}\\w+)`,"g")),o=[];if(s){let c=t.split(s);for(let l=0;l<c.length;l++)s.test(c[l])?o.push({type:"Placeholder",body:{type:"VariableReference",name:n[1]?c[l].slice(n[0].length,n[1].length*-1):c[l].slice(n[0].length)}}):c[l]!==""&&o.push({type:"Text",value:c[l]})}else o.push({type:"Text",value:t});return{type:"Message",metadata:{flatten:e.split(".").length>(i?2:1),isPrefixed:i},id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:o}}}var R=e=>{let t=[{spacing:1,regex:/^{\n {1}[^ ]+.*$/m},{spacing:2,regex:/^{\n {2}[^ ]+.*$/m},{spacing:3,regex:/^{\n {3}[^ ]+.*$/m},{spacing:4,regex:/^{\n {4}[^ ]+.*$/m},{spacing:6,regex:/^{\n {6}[^ ]+.*$/m},{spacing:8,regex:/^{\n {8}[^ ]+.*$/m},{spacing:"	",regex:/^{\n\t[^ ]+.*$/m}];for(let{spacing:i,regex:n}of t)if(n.test(e))return i;return 2};async function v(e){let[,t]=e.settings.pathPattern.split("{language}"),i=t.startsWith("/");for(let n of e.resources){let s=e.settings.pathPattern.replace("{language}",n.languageTag.name),o=n.metadata.space;if(i){let u=structuredClone(n.body),c=[];u.map(l=>{let a=l.id.name.split(".").shift();a&&!c.some(r=>r===a)&&c.push(a)});for(let l of c){let g=u.filter(r=>r.id.name.startsWith(l)).map(r=>({...r,id:{...r.id,name:r.id.name.replace(`${l}.`,"")}})),a={type:n.type,languageTag:n.languageTag,body:g};await e.$fs.writeFile(s.replace("*",l),T(a,o,e.settings.variableReferencePattern))}}else await e.$fs.writeFile(s,T(n,o,e.settings.variableReferencePattern))}}function T(e,t,i){let n={};return e.body.forEach((s,o)=>{let[u,c]=k(s,i);n={...n,[u.slice(-1)==="."?u.slice(0,-1)+"FINAL_CHAR_DOT":u]:s.metadata?.flatten?c:(0,h.unflatten)(c)}}),JSON.stringify(n,null,t).replace(/FINAL_CHAR_DOT/gm,".")}function k(e,t){let i=[];for(let s of e.pattern.elements)s.type==="Text"||!t?i.push(s.value):s.type==="Placeholder"&&(t[1]?i.push(`${t[0]}${s.body.name}${t[1]}`):i.push(`${t[0]}${s.body.name}`));let n=i.join("");return[e.id.name,n]}export{K as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
