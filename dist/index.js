var E=Object.create;var x=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of F(t))!K.call(e,n)&&n!==s&&x(e,n,{get:()=>t[n],enumerable:!(r=C(t,n))||r.enumerable});return e};var B=(e,t,s)=>(s=e!=null?E(N(e)):{},_(t||!e||!e.__esModule?x(s,"default",{value:e,enumerable:!0}):s,e));var A=L((Y,O)=>{O.exports=m;m.flatten=m;m.unflatten=P;function w(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function j(e){return e}function m(e,t){t=t||{};let s=t.delimiter||".",r=t.maxDepth,n=t.transformKey||j,o={};function l(a,u,g){g=g||1,Object.keys(a).forEach(function(c){let i=a[c],f=t.safe&&Array.isArray(i),p=Object.prototype.toString.call(i),d=w(i),h=p==="[object Object]"||p==="[object Array]",y=u?u+s+n(c):n(c);if(!f&&!d&&h&&Object.keys(i).length&&(!t.maxDepth||g<r))return l(i,y,g+1);o[y]=i})}return l(e),o}function P(e,t){t=t||{};let s=t.delimiter||".",r=t.overwrite||!1,n=t.transformKey||j,o={};if(w(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function a(c){let i=Number(c);return isNaN(i)||c.indexOf(".")!==-1||t.object?c:i}function u(c,i,f){return Object.keys(f).reduce(function(p,d){return p[c+s+d]=f[d],p},i)}function g(c){let i=Object.prototype.toString.call(c),f=i==="[object Array]",p=i==="[object Object]";if(c){if(f)return!c.length;if(p)return!Object.keys(c).length}else return!0}return e=Object.keys(e).reduce(function(c,i){let f=Object.prototype.toString.call(e[i]);return!(f==="[object Object]"||f==="[object Array]")||g(e[i])?(c[i]=e[i],c):u(i,c,m(e[i],t))},{}),Object.keys(e).forEach(function(c){let i=c.split(s).map(n),f=a(i.shift()),p=a(i[0]),d=o;for(;p!==void 0;){if(f==="__proto__")return;let h=Object.prototype.toString.call(d[f]),y=h==="[object Object]"||h==="[object Array]";if(!r&&!y&&typeof d[f]<"u")return;(r&&!y||!r&&d[f]==null)&&(d[f]=typeof p=="number"&&!t.object?[]:{}),d=d[f],i.length>0&&(f=a(i.shift()),p=a(i[0]))}d[f]=P(e[c],t)}),o}});function $(e){return t=>s=>e({settings:t,env:s})}var b=B(A(),1);function S(e){if(e.pathPattern===void 0)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.includes("{language}")===!1)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.endsWith(".json")===!1)throw new Error("The pathPattern setting must end with '.json'. An example would be './resources/{language}.json'.")}var J=$(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return S(e),{languages:await M({$fs:t.$fs,settings:e}),readResources:async s=>W({...s,$fs:t.$fs,settings:e}),writeResources:async s=>v({...s,$fs:t.$fs,settings:e})}}}));async function M(e){let[t,s]=e.settings.pathPattern.split("{language}"),r=await e.$fs.readdir(t),n=[];for(let o of r)if(o.includes("."))o.endsWith(".json")&&!e.settings.ignore?.some(l=>l===o)&&n.push(o.replace(".json",""));else for(let l of await e.$fs.readdir(`${t}${o}`))l.endsWith(".json")&&!e.settings.ignore?.some(a=>a===o)&&!n.some(a=>a===o)&&n.push(o);return n}async function W(e){let t=[];for(let s of e.config.languages){let r=e.settings.pathPattern.replace("{language}",s);try{let n=await e.$fs.readFile(r,{encoding:"utf-8"}),o=JSON.parse(n),l=T(await e.$fs.readFile(r,{encoding:"utf-8"}));t.push(I(o,s,!1,l,e.settings.variableReferencePattern))}catch{let n={},o=`${r.replace("/*.json","")}`,l=await e.$fs.readdir(o),a=T(await e.$fs.readFile(`${o}/${l[0]}`,{encoding:"utf-8"}));for(let u of l){let g={},c=await e.$fs.readFile(`${o}/${u}`,{encoding:"utf-8"});g[u.replace(".json","")]=JSON.parse(c),n={...n,...g}}t.push(I(n,s,!0,a,e.settings.variableReferencePattern))}}return t}function I(e,t,s,r,n){let o=(0,b.default)(e),l=k(e);return{type:"Resource",metadata:{space:r},languageTag:{type:"LanguageTag",name:t},body:Object.entries(o).map(([a,u])=>D(a,u,s,l,n))}}function D(e,t,s,r,n){let o=n&&(n[1]?new RegExp(`(\\${n[0]}[^\\${n[1]}]+\\${n[1]})`,"g"):new RegExp(`(${n}\\w+)`,"g")),l=[];if(o){let a=t.split(o);for(let u=0;u<a.length;u++)o.test(a[u])?l.push({type:"Placeholder",body:{type:"VariableReference",name:n[1]?a[u].slice(n[0].length,n[1].length*-1):a[u].slice(n[0].length)}}):a[u]!==""&&l.push({type:"Text",value:a[u]})}else l.push({type:"Text",value:t});return{type:"Message",metadata:{flatten:r,isPrefixed:s},id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:l}}}var k=e=>{for(let t in e)if(t.slice(0,-1).includes("."))return!0;return!1},T=e=>{let t=[{spacing:1,regex:/^{\n {1}[^ ]+.*$/m},{spacing:2,regex:/^{\n {2}[^ ]+.*$/m},{spacing:3,regex:/^{\n {3}[^ ]+.*$/m},{spacing:4,regex:/^{\n {4}[^ ]+.*$/m},{spacing:6,regex:/^{\n {6}[^ ]+.*$/m},{spacing:8,regex:/^{\n {8}[^ ]+.*$/m},{spacing:"	",regex:/^{\n\t[^ ]+.*$/m}];for(let{spacing:s,regex:r}of t)if(r.test(e))return s;return 2};async function v(e){let[,t]=e.settings.pathPattern.split("{language}"),s=t.startsWith("/");for(let r of e.resources){let n=e.settings.pathPattern.replace("{language}",r.languageTag.name),o=r.metadata.space;if(s){let l=structuredClone(r.body),a=[];l.map(u=>{let c=u.id.name.split(".").shift();c&&!a.some(i=>i===c)&&a.push(c)});for(let u of a){let g=l.filter(i=>i.id.name.startsWith(u)).map(i=>({...i,id:{...i.id,name:i.id.name.replace(`${u}.`,"")}})),c={type:r.type,languageTag:r.languageTag,body:g};await e.$fs.writeFile(n.replace("*",u),R(c,o,e.settings.variableReferencePattern))}}else await e.$fs.writeFile(n,R(r,o,e.settings.variableReferencePattern))}}function R(e,t,s){let r={};return e.body.forEach((n,o)=>{let[l,a]=z(n,s);r={...r,[l.slice(-1)==="."?l.slice(0,-1)+"FINAL_CHAR_DOT":l]:n.metadata?.flatten?a:(0,b.unflatten)(a)}}),JSON.stringify(r,null,t).replace(/FINAL_CHAR_DOT/gm,".")}function z(e,t){let s=[];for(let n of e.pattern.elements)n.type==="Text"||!t?s.push(n.value):n.type==="Placeholder"&&(t[1]?s.push(`${t[0]}${n.body.name}${t[1]}`):s.push(`${t[0]}${n.body.name}`));let r=s.join("");return[e.id.name,r]}export{J as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
