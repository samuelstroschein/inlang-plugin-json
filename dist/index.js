var A=Object.create;var w=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var M=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of C(t))!B.call(e,r)&&r!==n&&w(e,r,{get:()=>t[r],enumerable:!(s=R(t,r))||s.enumerable});return e};var N=(e,t,n)=>(n=e!=null?A(_(e)):{},M(t||!e||!e.__esModule?w(n,"default",{value:e,enumerable:!0}):n,e));var O=K((Z,$)=>{$.exports=y;y.flatten=y;y.unflatten=P;function j(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function x(e){return e}function y(e,t){t=t||{};let n=t.delimiter||".",s=t.maxDepth,r=t.transformKey||x,i={};function f(g,h,p){p=p||1,Object.keys(g).forEach(function(a){let o=g[a],u=t.safe&&Array.isArray(o),c=Object.prototype.toString.call(o),l=j(o),m=c==="[object Object]"||c==="[object Array]",d=h?h+n+r(a):r(a);if(!u&&!l&&m&&Object.keys(o).length&&(!t.maxDepth||p<s))return f(o,d,p+1);i[d]=o})}return f(e),i}function P(e,t){t=t||{};let n=t.delimiter||".",s=t.overwrite||!1,r=t.transformKey||x,i={};if(j(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function g(a){let o=Number(a);return isNaN(o)||a.indexOf(".")!==-1||t.object?a:o}function h(a,o,u){return Object.keys(u).reduce(function(c,l){return c[a+n+l]=u[l],c},o)}function p(a){let o=Object.prototype.toString.call(a),u=o==="[object Array]",c=o==="[object Object]";if(a){if(u)return!a.length;if(c)return!Object.keys(a).length}else return!0}return e=Object.keys(e).reduce(function(a,o){let u=Object.prototype.toString.call(e[o]);return!(u==="[object Object]"||u==="[object Array]")||p(e[o])?(a[o]=e[o],a):h(o,a,y(e[o],t))},{}),Object.keys(e).forEach(function(a){let o=a.split(n).map(r),u=g(o.shift()),c=g(o[0]),l=i;for(;c!==void 0;){if(u==="__proto__")return;let m=Object.prototype.toString.call(l[u]),d=m==="[object Object]"||m==="[object Array]";if(!s&&!d&&typeof l[u]<"u")return;(s&&!d||!s&&l[u]==null)&&(l[u]=typeof c=="number"&&!t.object?[]:{}),l=l[u],o.length>0&&(u=g(o.shift()),c=g(o[0]))}l[u]=P(e[a],t)}),i}});function b(e){return t=>n=>e({settings:t,env:n})}var T=N(O(),1);var E=v;function v(e,t,n){var s,r;if(Array.isArray(t)&&(s=t.slice(0)),typeof t=="string"&&(s=t.split(".")),typeof t=="symbol"&&(s=[t]),!Array.isArray(s))throw new Error("props arg must be an array, a string or a symbol");if(r=s.pop(),!r)return!1;S(r);for(var i;i=s.shift();)if(S(i),typeof e[i]>"u"&&(e[i]={}),e=e[i],!e||typeof e!="object")return!1;return e[r]=n,!0}function S(e){if(e=="__proto__"||e=="constructor"||e=="prototype")throw new Error("setting of prototype values not supported")}function I(e){if(e.pathPattern===void 0)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.includes("{language}")===!1)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.endsWith(".json")===!1)throw new Error("The pathPattern setting must end with '.json'. An example would be './resources/{language}.json'.")}var J=b(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return I(e),{languages:await L({$fs:t.$fs,settings:e}),readResources:async n=>k({...n,$fs:t.$fs,settings:e}),writeResources:async n=>z({...n,$fs:t.$fs,settings:e})}}}));async function L(e){let[t,n]=e.settings.pathPattern.split("{language}"),s=await e.$fs.readdir(t),r=[];for(let i of s)typeof i=="string"&&i.endsWith(".json")&&r.push(i.replace(".json",""));return r}async function k(e){let t=[];for(let n of e.config.languages){let s=e.settings.pathPattern.replace("{language}",n),r=JSON.parse(await e.$fs.readFile(s,{encoding:"utf-8"})),i=(0,T.default)(r);t.push(F(i,n,e.settings.variableReferencePattern))}return t}async function z(e){for(let t of e.resources){let n=e.settings.pathPattern.replace("{language}",t.languageTag.name);await e.$fs.writeFile(n,D(t,e.settings.variableReferencePattern))}}function F(e,t,n){return{type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([s,r])=>W(s,r,n))}}function W(e,t,n){let s=n&&(n[1]?new RegExp(`(\\${n[0]}[^\\${n[1]}]+\\${n[1]})`,"g"):new RegExp(`(${n}\\w+)`,"g")),r=[];if(s){let i=t.split(s);for(let f=0;f<i.length;f++)s.test(i[f])?r.push({type:"Placeholder",body:{type:"VariableReference",name:n[1]?i[f].slice(n[0].length,n[1].length*-1):i[f].slice(n[0].length)}}):i[f]!==""&&r.push({type:"Text",value:i[f]})}else r.push({type:"Text",value:t});return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:r}}}function D(e,t){let n={};return e.body.forEach(s=>{let[r,i]=V(s,t);E(n,r,i)}),JSON.stringify(n,null,2)}function V(e,t){let n=[];for(let r of e.pattern.elements)r.type==="Text"||!t?n.push(r.value):r.type==="Placeholder"&&(t[1]?n.push(`${t[0]}${r.body.name}${t[1]}`):n.push(`${t[0]}${r.body.name}`));let s=n.join("");return[e.id.name,s]}export{J as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
