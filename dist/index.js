var je=Object.create;var X=Object.defineProperty;var Ne=Object.getOwnPropertyDescriptor;var Ee=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var Fe=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ze=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ee(t))!Me.call(e,i)&&i!==n&&X(e,i,{get:()=>t[i],enumerable:!(r=Ne(t,i))||r.enumerable});return e};var Ue=(e,t,n)=>(n=e!=null?je(Re(e)):{},ze(t||!e||!e.__esModule?X(n,"default",{value:e,enumerable:!0}):n,e));var Se=Fe((x,v)=>{var De=200,se="__lodash_hash_undefined__",Le=800,Be=16,oe=9007199254740991,ue="[object Arguments]",Ge="[object Array]",He="[object AsyncFunction]",We="[object Boolean]",Je="[object Date]",Ve="[object Error]",fe="[object Function]",qe="[object GeneratorFunction]",Ke="[object Map]",Xe="[object Number]",Ye="[object Null]",le="[object Object]",Ze="[object Proxy]",Qe="[object RegExp]",ke="[object Set]",et="[object String]",tt="[object Undefined]",nt="[object WeakMap]",rt="[object ArrayBuffer]",it="[object DataView]",at="[object Float32Array]",st="[object Float64Array]",ot="[object Int8Array]",ut="[object Int16Array]",ft="[object Int32Array]",lt="[object Uint8Array]",ct="[object Uint8ClampedArray]",gt="[object Uint16Array]",pt="[object Uint32Array]",dt=/[\\^$.*+?()[\]{}|]/g,ht=/^\[object .+?Constructor\]$/,yt=/^(?:0|[1-9]\d*)$/,f={};f[at]=f[st]=f[ot]=f[ut]=f[ft]=f[lt]=f[ct]=f[gt]=f[pt]=!0;f[ue]=f[Ge]=f[rt]=f[We]=f[it]=f[Je]=f[Ve]=f[fe]=f[Ke]=f[Xe]=f[le]=f[Qe]=f[ke]=f[et]=f[nt]=!1;var ce=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,mt=typeof self=="object"&&self&&self.Object===Object&&self,P=ce||mt||Function("return this")(),ge=typeof x=="object"&&x&&!x.nodeType&&x,$=ge&&typeof v=="object"&&v&&!v.nodeType&&v,pe=$&&$.exports===ge,z=pe&&ce.process,Z=function(){try{var e=$&&$.require&&$.require("util").types;return e||z&&z.binding&&z.binding("util")}catch{}}(),Q=Z&&Z.isTypedArray;function _t(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function bt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function vt(e){return function(t){return e(t)}}function wt(e,t){return e?.[t]}function Tt(e,t){return function(n){return e(t(n))}}var xt=Array.prototype,$t=Function.prototype,I=Object.prototype,U=P["__core-js_shared__"],j=$t.toString,g=I.hasOwnProperty,k=function(){var e=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),de=I.toString,St=j.call(Object),Pt=RegExp("^"+j.call(g).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),O=pe?P.Buffer:void 0,ee=P.Symbol,te=P.Uint8Array,ne=O?O.allocUnsafe:void 0,he=Tt(Object.getPrototypeOf,Object),re=Object.create,At=I.propertyIsEnumerable,Ot=xt.splice,m=ee?ee.toStringTag:void 0,C=function(){try{var e=W(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ct=O?O.isBuffer:void 0,ie=Math.max,It=Date.now,ye=W(P,"Map"),S=W(Object,"create"),jt=function(){function e(){}return function(t){if(!b(t))return{};if(re)return re(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function _(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Nt(){this.__data__=S?S(null):{},this.size=0}function Et(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Rt(e){var t=this.__data__;if(S){var n=t[e];return n===se?void 0:n}return g.call(t,e)?t[e]:void 0}function Mt(e){var t=this.__data__;return S?t[e]!==void 0:g.call(t,e)}function Ft(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=S&&t===void 0?se:t,this}_.prototype.clear=Nt;_.prototype.delete=Et;_.prototype.get=Rt;_.prototype.has=Mt;_.prototype.set=Ft;function p(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function zt(){this.__data__=[],this.size=0}function Ut(e){var t=this.__data__,n=N(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Ot.call(t,n,1),--this.size,!0}function Dt(e){var t=this.__data__,n=N(t,e);return n<0?void 0:t[n][1]}function Lt(e){return N(this.__data__,e)>-1}function Bt(e,t){var n=this.__data__,r=N(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}p.prototype.clear=zt;p.prototype.delete=Ut;p.prototype.get=Dt;p.prototype.has=Lt;p.prototype.set=Bt;function w(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Gt(){this.size=0,this.__data__={hash:new _,map:new(ye||p),string:new _}}function Ht(e){var t=R(this,e).delete(e);return this.size-=t?1:0,t}function Wt(e){return R(this,e).get(e)}function Jt(e){return R(this,e).has(e)}function Vt(e,t){var n=R(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}w.prototype.clear=Gt;w.prototype.delete=Ht;w.prototype.get=Wt;w.prototype.has=Jt;w.prototype.set=Vt;function T(e){var t=this.__data__=new p(e);this.size=t.size}function qt(){this.__data__=new p,this.size=0}function Kt(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Xt(e){return this.__data__.get(e)}function Yt(e){return this.__data__.has(e)}function Zt(e,t){var n=this.__data__;if(n instanceof p){var r=n.__data__;if(!ye||r.length<De-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new w(r)}return n.set(e,t),this.size=n.size,this}T.prototype.clear=qt;T.prototype.delete=Kt;T.prototype.get=Xt;T.prototype.has=Yt;T.prototype.set=Zt;function Qt(e,t){var n=G(e),r=!n&&B(e),i=!n&&!r&&ve(e),a=!n&&!r&&!i&&Te(e),s=n||r||i||a,o=s?bt(e.length,String):[],u=o.length;for(var l in e)(t||g.call(e,l))&&!(s&&(l=="length"||i&&(l=="offset"||l=="parent")||a&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||_e(l,u)))&&o.push(l);return o}function D(e,t,n){(n!==void 0&&!M(e[t],n)||n===void 0&&!(t in e))&&H(e,t,n)}function kt(e,t,n){var r=e[t];(!(g.call(e,t)&&M(r,n))||n===void 0&&!(t in e))&&H(e,t,n)}function N(e,t){for(var n=e.length;n--;)if(M(e[n][0],t))return n;return-1}function H(e,t,n){t=="__proto__"&&C?C(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var en=dn();function E(e){return e==null?e===void 0?tt:Ye:m&&m in Object(e)?hn(e):wn(e)}function ae(e){return A(e)&&E(e)==ue}function tn(e){if(!b(e)||bn(e))return!1;var t=V(e)?Pt:ht;return t.test(Sn(e))}function nn(e){return A(e)&&we(e.length)&&!!f[E(e)]}function rn(e){if(!b(e))return vn(e);var t=be(e),n=[];for(var r in e)r=="constructor"&&(t||!g.call(e,r))||n.push(r);return n}function me(e,t,n,r,i){e!==t&&en(t,function(a,s){if(i||(i=new T),b(a))an(e,t,s,n,me,r,i);else{var o=r?r(L(e,s),a,s+"",e,t,i):void 0;o===void 0&&(o=a),D(e,s,o)}},xe)}function an(e,t,n,r,i,a,s){var o=L(e,n),u=L(t,n),l=s.get(u);if(l){D(e,n,l);return}var c=a?a(o,u,n+"",e,t,s):void 0,h=c===void 0;if(h){var y=G(u),d=!y&&ve(u),K=!y&&!d&&Te(u);c=u,y||d||K?G(o)?c=o:Pn(o)?c=cn(o):d?(h=!1,c=un(u,!0)):K?(h=!1,c=ln(u,!0)):c=[]:An(u)||B(u)?(c=o,B(o)?c=On(o):(!b(o)||V(o))&&(c=yn(u))):h=!1}h&&(s.set(u,c),i(c,u,r,a,s),s.delete(u)),D(e,n,c)}function sn(e,t){return xn(Tn(e,t,$e),e+"")}var on=C?function(e,t){return C(e,"toString",{configurable:!0,enumerable:!1,value:In(t),writable:!0})}:$e;function un(e,t){if(t)return e.slice();var n=e.length,r=ne?ne(n):new e.constructor(n);return e.copy(r),r}function fn(e){var t=new e.constructor(e.byteLength);return new te(t).set(new te(e)),t}function ln(e,t){var n=t?fn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function cn(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function gn(e,t,n,r){var i=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var o=t[a],u=r?r(n[o],e[o],o,n,e):void 0;u===void 0&&(u=e[o]),i?H(n,o,u):kt(n,o,u)}return n}function pn(e){return sn(function(t,n){var r=-1,i=n.length,a=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(a=e.length>3&&typeof a=="function"?(i--,a):void 0,s&&mn(n[0],n[1],s)&&(a=i<3?void 0:a,i=1),t=Object(t);++r<i;){var o=n[r];o&&e(t,o,r,a)}return t})}function dn(e){return function(t,n,r){for(var i=-1,a=Object(t),s=r(t),o=s.length;o--;){var u=s[e?o:++i];if(n(a[u],u,a)===!1)break}return t}}function R(e,t){var n=e.__data__;return _n(t)?n[typeof t=="string"?"string":"hash"]:n.map}function W(e,t){var n=wt(e,t);return tn(n)?n:void 0}function hn(e){var t=g.call(e,m),n=e[m];try{e[m]=void 0;var r=!0}catch{}var i=de.call(e);return r&&(t?e[m]=n:delete e[m]),i}function yn(e){return typeof e.constructor=="function"&&!be(e)?jt(he(e)):{}}function _e(e,t){var n=typeof e;return t=t??oe,!!t&&(n=="number"||n!="symbol"&&yt.test(e))&&e>-1&&e%1==0&&e<t}function mn(e,t,n){if(!b(n))return!1;var r=typeof t;return(r=="number"?J(n)&&_e(t,n.length):r=="string"&&t in n)?M(n[t],e):!1}function _n(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function bn(e){return!!k&&k in e}function be(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||I;return e===n}function vn(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}function wn(e){return de.call(e)}function Tn(e,t,n){return t=ie(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=ie(r.length-t,0),s=Array(a);++i<a;)s[i]=r[t+i];i=-1;for(var o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(s),_t(e,this,o)}}function L(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var xn=$n(on);function $n(e){var t=0,n=0;return function(){var r=It(),i=Be-(r-n);if(n=r,i>0){if(++t>=Le)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Sn(e){if(e!=null){try{return j.call(e)}catch{}try{return e+""}catch{}}return""}function M(e,t){return e===t||e!==e&&t!==t}var B=ae(function(){return arguments}())?ae:function(e){return A(e)&&g.call(e,"callee")&&!At.call(e,"callee")},G=Array.isArray;function J(e){return e!=null&&we(e.length)&&!V(e)}function Pn(e){return A(e)&&J(e)}var ve=Ct||jn;function V(e){if(!b(e))return!1;var t=E(e);return t==fe||t==qe||t==He||t==Ze}function we(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=oe}function b(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function A(e){return e!=null&&typeof e=="object"}function An(e){if(!A(e)||E(e)!=le)return!1;var t=he(e);if(t===null)return!0;var n=g.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&j.call(n)==St}var Te=Q?vt(Q):nn;function On(e){return gn(e,xe(e))}function xe(e){return J(e)?Qt(e,!0):rn(e)}var Cn=pn(function(e,t,n){me(e,t,n)});function In(e){return function(){return e}}function $e(e){return e}function jn(){return!1}v.exports=Cn});function F(e){return t=>n=>e({settings:t,env:n})}function Y(e){if(e.pathPattern===void 0)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.includes("{language}")===!1)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.endsWith(".json")===!1)throw new Error("The pathPattern setting must end with '.json'. An example would be './resources/{language}.json'.")}var Ce=Ue(Se(),1),Nn=F(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return Y(e),{languages:await En({$fs:t.$fs,settings:e}),readResources:async n=>Rn({...n,$fs:t.$fs,settings:e}),writeResources:async n=>Fn({...n,$fs:t.$fs,settings:e})}}}));async function En(e){let[t,n]=e.settings.pathPattern.split("{language}"),r=await e.$fs.readdir(t),i=[];for(let a of r)if(a.includes("."))a.endsWith(".json")&&!e.settings.ignore?.some(s=>s===a)&&i.push(a.replace(".json",""));else for(let s of await e.$fs.readdir(`${t}${a}`))s.endsWith(".json")&&!e.settings.ignore?.some(o=>o===a)&&!i.some(o=>o===a)&&i.push(a);return i}async function Rn(e){let t=[];for(let n of e.config.languages){let r=e.settings.pathPattern.replace("{language}",n);try{let i=await e.$fs.readFile(r,{encoding:"utf-8"}),a=Ae(await e.$fs.readFile(r,{encoding:"utf-8"})),s=q(JSON.parse(i)),o={};s.map(u=>{o={...o,[u.id]:{value:u.value,parents:u.parents,fileName:void 0,keyName:u.keyName}}}),t.push(Pe(o,n,a,e.settings.variableReferencePattern))}catch{let i={},a=`${r.replace("/*.json","")}`,s=await e.$fs.readdir(a),o=Ae(await e.$fs.readFile(`${a}/${s[0]}`,{encoding:"utf-8"}));for(let u of s){let l=await e.$fs.readFile(`${a}/${u}`,{encoding:"utf-8"}),c=u.replace(".json",""),h=q(JSON.parse(l),[],c),y={};h.map(d=>{y={...y,[d.id]:{value:d.value,parents:d.parents,fileName:c,keyName:d.keyName}}}),i={...i,...y}}t.push(Pe(i,n,o,e.settings.variableReferencePattern))}}return t}function Pe(e,t,n,r){return{type:"Resource",metadata:{space:n},languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([i,a])=>Mn(i,a,r))}}function Mn(e,t,n){let r=n&&(n[1]?new RegExp(`(\\${n[0]}[^\\${n[1]}]+\\${n[1]})`,"g"):new RegExp(`(${n}\\w+)`,"g")),i=[];if(r){let a=t.value.split(r);for(let s=0;s<a.length;s++)r.test(a[s])?i.push({type:"Placeholder",body:{type:"VariableReference",name:n[1]?a[s].slice(n[0].length,n[1].length*-1):a[s].slice(n[0].length)}}):a[s]!==""&&i.push({type:"Text",value:a[s]})}else i.push({type:"Text",value:t.value});return{type:"Message",metadata:{...t.fileName!==void 0&&{fileName:t.fileName},...t.parents!==void 0&&{parentKeys:t.parents},...t.keyName!==void 0&&{keyName:t.keyName}},id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:i}}}var q=(e,t=[],n)=>{let r=[];if(typeof e=="string")r.push({value:e,parents:t.length>1?t.slice(0,-1):void 0,id:n?n+"."+t.join("."):t.join("."),keyName:t[t.length-1]});else if(typeof e=="object"&&e!==null){for(let i in e)if(e.hasOwnProperty(i)){let a=[...t,i],s=q(e[i],a,n);r.push(...s)}}return r},Ae=e=>{let t=[{spacing:1,regex:/^{\n {1}[^ ]+.*$/m},{spacing:2,regex:/^{\n {2}[^ ]+.*$/m},{spacing:3,regex:/^{\n {3}[^ ]+.*$/m},{spacing:4,regex:/^{\n {4}[^ ]+.*$/m},{spacing:6,regex:/^{\n {6}[^ ]+.*$/m},{spacing:8,regex:/^{\n {8}[^ ]+.*$/m},{spacing:"	",regex:/^{\n\t[^ ]+.*$/m}];for(let{spacing:n,regex:r}of t)if(r.test(e))return n;return 2};async function Fn(e){for(let t of e.resources){let n=e.settings.pathPattern.replace("{language}",t.languageTag.name),r=t.metadata?.space;if(t.body.some(i=>i.metadata?.fileName)){let i=structuredClone(t.body),a=[];i.map(s=>{s.metadata?.fileName&&!a.some(o=>o===s.metadata?.fileName)&&a.push(s.metadata?.fileName)});for(let s of a){let o=i.filter(l=>l.id.name.startsWith(s)).map(l=>({...l,id:{...l.id,name:l.id.name.replace(`${s}.`,"")}})),u={type:t.type,languageTag:t.languageTag,body:o};await e.$fs.writeFile(n.replace("*",s),Oe(u,r,e.settings.variableReferencePattern))}}else await e.$fs.writeFile(n,Oe(t,r,e.settings.variableReferencePattern))}}function Oe(e,t,n){let r={};return e.body.forEach(i=>{let a=zn(i,n);(0,Ce.default)(r,a)}),JSON.stringify(r,null,t)}var zn=(e,t)=>{let n=[];for(let a of e.pattern.elements)a.type==="Text"||!t?n.push(a.value):a.type==="Placeholder"&&(t[1]?n.push(`${t[0]}${a.body.name}${t[1]}`):n.push(`${t[0]}${a.body.name}`));let r=n.join(""),i={};return Ie(i,e.metadata?.parentKeys,e.metadata?.keyName,r),i},Ie=(e,t,n,r)=>{!t||t.length===0?e[n]=r:t.length===1?e[t[0]]={[n]:r}:(e[t[0]]||(e[t[0]]={}),Ie(e[t[0]],t.slice(1),n,r))};export{Nn as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
