var E=Object.create;var x=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of F(t))!K.call(e,s)&&s!==i&&x(e,s,{get:()=>t[s],enumerable:!(n=C(t,s))||n.enumerable});return e};var B=(e,t,i)=>(i=e!=null?E(N(e)):{},_(t||!e||!e.__esModule?x(i,"default",{value:e,enumerable:!0}):i,e));var A=L((Y,O)=>{O.exports=m;m.flatten=m;m.unflatten=P;function w(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function j(e){return e}function m(e,t){t=t||{};let i=t.delimiter||".",n=t.maxDepth,s=t.transformKey||j,o={};function l(a,f,g){g=g||1,Object.keys(a).forEach(function(c){let r=a[c],u=t.safe&&Array.isArray(r),p=Object.prototype.toString.call(r),d=w(r),h=p==="[object Object]"||p==="[object Array]",y=f?f+i+s(c):s(c);if(!u&&!d&&h&&Object.keys(r).length&&(!t.maxDepth||g<n))return l(r,y,g+1);o[y]=r})}return l(e),o}function P(e,t){t=t||{};let i=t.delimiter||".",n=t.overwrite||!1,s=t.transformKey||j,o={};if(w(e)||Object.prototype.toString.call(e)!=="[object Object]")return e;function a(c){let r=Number(c);return isNaN(r)||c.indexOf(".")!==-1||t.object?c:r}function f(c,r,u){return Object.keys(u).reduce(function(p,d){return p[c+i+d]=u[d],p},r)}function g(c){let r=Object.prototype.toString.call(c),u=r==="[object Array]",p=r==="[object Object]";if(c){if(u)return!c.length;if(p)return!Object.keys(c).length}else return!0}return e=Object.keys(e).reduce(function(c,r){let u=Object.prototype.toString.call(e[r]);return!(u==="[object Object]"||u==="[object Array]")||g(e[r])?(c[r]=e[r],c):f(r,c,m(e[r],t))},{}),Object.keys(e).forEach(function(c){let r=c.split(i).map(s),u=a(r.shift()),p=a(r[0]),d=o;for(;p!==void 0;){if(u==="__proto__")return;let h=Object.prototype.toString.call(d[u]),y=h==="[object Object]"||h==="[object Array]";if(!n&&!y&&typeof d[u]<"u")return;(n&&!y||!n&&d[u]==null)&&(d[u]=typeof p=="number"&&!t.object?[]:{}),d=d[u],r.length>0&&(u=a(r.shift()),p=a(r[0]))}d[u]=P(e[c],t)}),o}});function $(e){return t=>i=>e({settings:t,env:i})}var b=B(A(),1);function S(e){if(e.pathPattern===void 0)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.includes("{language}")===!1)throw new Error("The pathPattern setting must be defined and include the {language} placeholder. An example would be './resources/{language}.json'.");if(e.pathPattern.endsWith(".json")===!1)throw new Error("The pathPattern setting must end with '.json'. An example would be './resources/{language}.json'.")}var J=$(({settings:e,env:t})=>({id:"samuelstroschein.inlangPluginJson",async config(){return S(e),{languages:await M({$fs:t.$fs,settings:e}),readResources:async i=>W({...i,$fs:t.$fs,settings:e}),writeResources:async i=>v({...i,$fs:t.$fs,settings:e})}}}));async function M(e){let[t,i]=e.settings.pathPattern.split("{language}"),n=await e.$fs.readdir(t),s=[];for(let o of n)if(o.includes("."))o.endsWith(".json")&&!e.settings.ignore?.some(l=>l===o)&&s.push(o.replace(".json",""));else for(let l of await e.$fs.readdir(`${t}${o}`))l.endsWith(".json")&&!e.settings.ignore?.some(a=>a===o)&&!s.some(a=>a===o)&&s.push(o);return s}async function W(e){let t=[];for(let i of e.config.languages){let n=e.settings.pathPattern.replace("{language}",i);try{let s=await e.$fs.readFile(n,{encoding:"utf-8"}),o=JSON.parse(s),l=T(await e.$fs.readFile(n,{encoding:"utf-8"}));t.push(I(o,i,!1,l,e.settings.variableReferencePattern))}catch{let s={},o=`${n.replace("/*.json","")}`,l=await e.$fs.readdir(o),a=T(await e.$fs.readFile(`${o}/${l[0]}`,{encoding:"utf-8"}));for(let f of l){let g={},c=await e.$fs.readFile(`${o}/${f}`,{encoding:"utf-8"});g[f.replace(".json","")]=JSON.parse(c),s={...s,...g}}t.push(I(s,i,!0,a,e.settings.variableReferencePattern))}}return t}function I(e,t,i,n,s){let o=(0,b.default)(e),l=k(e);return{type:"Resource",metadata:{space:n,flatten:l},languageTag:{type:"LanguageTag",name:t},body:Object.entries(o).map(([a,f])=>D(a,f,i,s))}}function D(e,t,i,n){let s=n&&(n[1]?new RegExp(`(\\${n[0]}[^\\${n[1]}]+\\${n[1]})`,"g"):new RegExp(`(${n}\\w+)`,"g")),o=[];if(s){let l=t.split(s);for(let a=0;a<l.length;a++)s.test(l[a])?o.push({type:"Placeholder",body:{type:"VariableReference",name:n[1]?l[a].slice(n[0].length,n[1].length*-1):l[a].slice(n[0].length)}}):l[a]!==""&&o.push({type:"Text",value:l[a]})}else o.push({type:"Text",value:t});return{type:"Message",metadata:{isPrefixed:i},id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:o}}}var k=e=>{for(let t in e)if(t.slice(0,-1).includes("."))return!0;return!1},T=e=>{let t=[{spacing:1,regex:/^{\n {1}[^ ]+.*$/m},{spacing:2,regex:/^{\n {2}[^ ]+.*$/m},{spacing:3,regex:/^{\n {3}[^ ]+.*$/m},{spacing:4,regex:/^{\n {4}[^ ]+.*$/m},{spacing:6,regex:/^{\n {6}[^ ]+.*$/m},{spacing:8,regex:/^{\n {8}[^ ]+.*$/m},{spacing:"	",regex:/^{\n\t[^ ]+.*$/m}];for(let{spacing:i,regex:n}of t)if(n.test(e))return i;return 2};async function v(e){let[,t]=e.settings.pathPattern.split("{language}"),i=t.startsWith("/");for(let n of e.resources){let s=e.settings.pathPattern.replace("{language}",n.languageTag.name),o=n.metadata.space;if(i){let l=structuredClone(n.body),a=[];l.map(f=>{let c=f.id.name.split(".").shift();c&&!a.some(r=>r===c)&&a.push(c)});for(let f of a){let g=l.filter(r=>r.id.name.startsWith(f)).map(r=>({...r,id:{...r.id,name:r.id.name.replace(`${f}.`,"")}})),c={type:n.type,languageTag:n.languageTag,body:g};await e.$fs.writeFile(s.replace("*",f),R(c,o,e.settings.variableReferencePattern))}}else await e.$fs.writeFile(s,R(n,o,e.settings.variableReferencePattern))}}function R(e,t,i){let n={};return e.body.forEach((s,o)=>{let[l,a]=z(s,i);n={...n,[l.slice(-1)==="."?l.slice(0,-1)+"FINAL_CHAR_DOT":l]:a}}),n=e.metadata?.flatten?n:(0,b.unflatten)(n),JSON.stringify(n,null,t).replace(/FINAL_CHAR_DOT/gm,".")}function z(e,t){let i=[];for(let s of e.pattern.elements)s.type==="Text"||!t?i.push(s.value):s.type==="Placeholder"&&(t[1]?i.push(`${t[0]}${s.body.name}${t[1]}`):i.push(`${t[0]}${s.body.name}`));let n=i.join("");return[e.id.name,n]}export{J as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
